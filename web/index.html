<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="utf-8">
	<title>Remote</title>
	<script type="text/javascript" src="./assets/plugins/vue/vue.js"></script>
	<script type="text/javascript" src="./assets/plugins/vue/vue-resource.min.js"></script>
	<script type="text/javascript" src="./assets/plugins/vue/filters/vue.pretty-bytes.filter.js"></script>
	<script type="text/javascript" src="./assets/plugins/vue/filters/vue.file-icon.filter.js"></script>
	<script type="text/javascript" src="./assets/plugins/vue/filters/vue.date-ptbr.filter.js"></script>
	<link rel="stylesheet" type="text/css" href="./assets/plugins/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="./assets/plugins/bootstrap/css/bootstrap-grid.min.css">
	<link rel="stylesheet" type="text/css" href="./assets/plugins/bootstrap/css/bootstrap-reboot.min.css">
	<link rel="stylesheet" type="text/css" href="./assets/plugins/fontawesome/css/fontawesome-all.min.css">
	<link rel="stylesheet" type="text/css" href="./assets/css/personalizacao.css">
	<link rel="stylesheet" type="text/css" href="./assets/plugins/icheck/skins/minimal/blue.css">

	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body>

	<div id="explorador" class="container">
		<div class="row">
  			<div class="col-md-12">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb" id="breadcrumb">

						<li class="breadcrumb-item"><a href="#"><i class="fa fa-home"></i></a></li>

						<li v-for="(value, index) in splitPath(resources.path)" class="breadcrumb-item">
							<a href="#">{{value}}</a>
						</li>

						<!-- <li class="breadcrumb-item"><a href="#">Library</a></li>
						<li class="breadcrumb-item active" aria-current="page">{{message}}</li> -->
					</ol>
				</nav>
  			</div>
		</div>

		<div class="row">
			<div class="col-md-9">
				<button @click="back();" class="btn btn-primary"><i class="fa fa-arrow-left"></i></button>
			</div>
			<div class="col-md-3">
				<input id="pesquisar" type="text" class="form-control" placeholder="Pesquisar">
			</div>
		</div>

		<div class="row">
			<div class="col-md-12">
				&nbsp;
			</div>
		</div>

		<div class="row">
			<div class="col-md-12">
				upload | delete | rename | move | copy
			</div>
		</div>



		<div class="row">
			<div class="col-md-12">
				<div class="table-responsive-md">
					<table class="table table-fixed table-selected">
						<thead>
							<tr>
								<th class="text-right">
									<input type="checkbox">
								</th>
								<th @click="sortBy('name')" class="text-left">Nome</th>
								<th @click="sortBy('type')" class="text-center">Tipo</th>
								<th @click="sortBy('size')" class="text-center">Tamanho</th>
								<th @click="sortBy('updated_at')" class="text-center">Alterado em</th>
							</tr>
						</thead>
						<tbody>


							<tr v-for="resource in resources.folders">
						    <td class="text-right">
						      <input type="checkbox">
						    </td>
						    <td class="text-left">
						      <span class="btn btn-link" @click="openFolder(resource.name)">
						        <i class="fa fa-folder"></i>
						        {{resource.name}}
						      </span>
						    </td>
						    <td class="text-center">Pasta</td>
						    <td class="text-center"> - </td>
						    <td class="text-center">{{resource.updated_at | datePtBr}}</td>
						  </tr>


							<tr v-for="resource in resources.files">
						    <td class="text-right">
						      <input type="checkbox">
						    </td>
						    <td class="text-left">
						      <span class="btn btn-link" @click="openFile(resource.name)">
						        <i :class="resource.name | fileIcon"></i>
						        {{resource.name}}
						      </span>
						    </td>
						    <td class="text-center">Arquivo</td>
						    <td class="text-center">{{resource.size | prettyBytes}}</td>
						    <td class="text-center">{{resource.updated_at | datePtBr}}</td>
						  </tr>


						</tbody>


						<tfoot>
							<tr>
								<td colspan="5">
									<small class="float-right text-muted">{{resources.folders.length}} pastas e {{resources.files.length}} arquivos.</small>
								</td>
							</tr>
						</tfoot>
					</table>
				</div>
			</div>
		</div>
	</div>



<script type="text/javascript" src="./assets/js/jquery-3.2.1.slim.min.js"></script>
<script type="text/javascript" src="./assets/js/popper.min.js"></script>
<script type="text/javascript" src="./assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="./assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>
</html>

<script type="text/javascript">

Vue.http.options.emulateJSON = true; // send

var explorador = new Vue({
	el: '#explorador',
	data: {
		message: 'explorador',
		resources: {
			folders: [],
			files: [],
			path: '/'
		},
		orderBy: {
			key: 'name',
			order: 1
		}
	},
	created: function(){
		this.getResources(this.path)
	},
	methods: {
		getResources: function(){
			this.$http.post(
				'emulate.device.route.php',
				{
					route: "listResources",
					variables: {
						"path": this.resources.path
					}
				}
			).then( response => {
			  this.resources = response.data
			});
		},
		splitPath: function(valuePath){
			return valuePath.split('/').filter(function(item){
				return !!item;
			});
		},
		sortBy: function(key){

			this.orderBy.order = this.orderBy.order *- 1;
			this.orderBy.key = key;

			this.resources.folders = this.resources.folders.sort(compareValues(key, this.orderBy.order));
			this.resources.files = this.resources.files.sort(compareValues(key, this.orderBy.order));

		},
		back: function(){

			let aux = this.splitPath(this.resources.path);
			aux.pop();

			if(aux.length)
				this.resources.path = '\\' + aux.join('\\') + '\\';
			else
				this.resources.path = '\\';

			this.getResources();
		},
		openFolder: function(folderName){
			this.resources.path += folderName + '/';

			this.getResources();
		}
	}

});



function compareValues(key, order=1) {
  return function(a, b) {
    if(!a.hasOwnProperty(key) || !b.hasOwnProperty(key)) {
      return 0;
    }

    const varA = (typeof a[key] === 'string') ?
      a[key].toUpperCase() : a[key];
    const varB = (typeof b[key] === 'string') ?
      b[key].toUpperCase() : b[key];

    let comparison = 0;
    if (varA > varB) {
      comparison = 1;
    } else if (varA < varB) {
      comparison = -1;
    }
    return comparison * order;
  };
}

</script>
